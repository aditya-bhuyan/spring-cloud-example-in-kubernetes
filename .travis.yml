sudo: enabled
language: java
jdk:
  - openjdk8

services:
  - docker
  
branches:
  only:
    - develop-gcr

cache:
  directories:
  - '$HOME/.m2/repository'
env:

before_install:
  - curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
  - curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64 && chmod +x skaffold && sudo mv skaffold /usr/local/bin/
  - export GOOGLE_APPLICATION_CREDENTIALS="${HOME}/build/atropos0116/spring-cloud-example-in-kubernetes/client_api_key.json"

script:
  - gcloud auth activate-service-account --key-file ${GOOGLE_APPLICATION_CREDENTIALS}
  - cd ${HOME}/build/atropos0116/spring-cloud-example-in-kubernetes/config-server
  - skaffold dev -p dev
  - cd ../users-service
  - skaffold dev -p dev
  - cd ../users-detail-service
  - skaffold dev -p dev 
  
